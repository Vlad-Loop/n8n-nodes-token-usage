# n8n-nodes-token-usage

<div align="center">

[üá∫üá∏ English](https://github.com/Vlad-Loop/n8n-nodes-token-usage/blob/master/README.md) | üá∑üá∫ –†—É—Å—Å–∫–∏–π

</div>

[![npm version](https://img.shields.io/npm/v/n8n-nodes-token-usage.svg)](https://www.npmjs.com/package/n8n-nodes-token-usage)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

–ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–æ–¥—ã –¥–ª—è n8n, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ LLM –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.

**–ó–∞—á–µ–º —ç—Ç–æ—Ç –ø–∞–∫–µ—Ç:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ AI –º–æ–¥–µ–ª–µ–π –≤ n8n workflows –≤–∞–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ n8n executions —á–µ—Ä–µ–∑ n8n API –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω OpenRouter.

![Telegram Stars node](https://raw.githubusercontent.com/Vlad-Loop/n8n-nodes-token-usage/master/screenshots/screen-1.png)

## –ù–æ–¥—ã

### Token Usage
- **Save Execution ID** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ execution ID –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- **Get Token Usage** - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö executions —á–µ—Ä–µ–∑ n8n API
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ–±—â–∞–µ—Ç –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ OpenRouter)

### Token Cost (OpenRouter)
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω OpenRouter API
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç promptCost, completionCost –∏ totalCost –≤ USD
- –†–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** –≤ —Å–≤—è–∑–∫–µ —Å Token Usage (Get Token Usage)

## –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å

–ü–∞–∫–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ AI –Ω–æ–¥–∞–º–∏ n8n:
- **AI Agent (+tools)**
- **Basic LLM Chain**
- **Guardrails**

> **–í–∞–∂–Ω–æ:** –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ç–æ—á–Ω–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ —Å ID –º–æ–¥–µ–ª–∏ –≤ OpenRouter (–Ω–∞–ø—Ä–∏–º–µ—Ä, `openai/gpt-4o-mini`, `anthropic/claude-3-sonnet`).

## –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ß–µ—Ä–µ–∑ Community Nodes (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** > **Community Nodes**
3. –ù–∞–∂–º–∏—Ç–µ **Install**
4. –í–≤–µ–¥–∏—Ç–µ `n8n-nodes-token-usage`
5. –ù–∞–∂–º–∏—Ç–µ **Install**

### –ß–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

1. –°–∫–∞—á–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
npm install
npm run build
npm link
```

3. –í –ø–æ–¥–Ω—è—Ç–æ–º –ª–æ–∫–∞–ª—å–Ω–æ n8n:
```bash
cd ~/.n8n
mkdir custom && cd custom
npm init -y
npm link n8n-nodes-token-usage

# –ó–∞–ø—É—Å—Ç–∏—Ç—å n8n
n8n
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–ª—è Token Usage
1. –í n8n –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** > **n8n API**
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –í –≤–∞—à–µ–º workflow —Å–æ–∑–¥–∞–π—Ç–µ credential —Ç–∏–ø–∞ **n8n API**
4. –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –∏ base URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://localhost:5678`)

### –î–ª—è Token Cost (OpenRouter)
1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –Ω–∞ [OpenRouter](https://openrouter.ai/keys)
2. –í –≤–∞—à–µ–º workflow —Å–æ–∑–¥–∞–π—Ç–µ credential —Ç–∏–ø–∞ **OpenRouter API**
3. –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á

## –û–ø–µ—Ä–∞—Ü–∏–∏

### 1. Save Execution ID (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é)

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π execution ID workflow. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–Ω—Ü–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ workflow –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ID –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤.

**–í—ã–≤–æ–¥:**
```json
{
  "execution_id": "267"
}
```

### 2. Get Token Usage

–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ execution. –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç n8n API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö execution –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ LLM –∏–∑ –≤—ã–≤–æ–¥–æ–≤ `ai_languageModel`.

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- Execution ID (–∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–∏ Save –∏–ª–∏ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)

**–í—ã–≤–æ–¥:**
```json
{
  "execution_id": "267",
  "totalTokenUsage": {
    "promptTokens": 13,
    "completionTokens": 20,
    "totalTokens": 33
  },
  "llmCalls": [
    {
      "nodeName": "OpenAI Chat Model",
      "tokenUsage": {
        "promptTokens": 13,
        "completionTokens": 20,
        "totalTokens": 33
      },
      "model": "openai/gpt-4o-mini",
      "messages": ["Human: Hello"],
      "estimatedTokens": 8
    }
  ]
}
```

### 3. Token Cost (OpenRouter)

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω OpenRouter.

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç Token Usage (Get Token Usage)
- OpenRouter API credentials

**–í—ã–≤–æ–¥:**
```json
{
  "execution_id": "267",
  "totalTokenUsage": {
    "promptTokens": 13,
    "completionTokens": 20,
    "totalTokens": 33
  },
  "llmCalls": [
    {
      "nodeName": "OpenAI Chat Model",
      "tokenUsage": {
        "promptTokens": 13,
        "completionTokens": 20,
        "totalTokens": 33
      },
      "model": "openai/gpt-4o-mini",
      "messages": ["Human: Hello"],
      "estimatedTokens": 8,
      "cost": {
        "promptCost": 0.00000195,
        "completionCost": 0.00000600,
        "totalCost": 0.00000795,
        "currency": "USD"
      }
    }
  ],
  "totalCost": {
    "promptCost": 0.00000195,
    "completionCost": 0.00000600,
    "totalCost": 0.00000795,
    "currency": "USD"
  }
}
```

## –ü–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Sub-Workflow:

1. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ **Token Usage (Save Execution ID)** –≤ –∫–æ–Ω—Ü–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ workflow –ø–æ—Å–ª–µ LLM –Ω–æ–¥
2. –ü–µ—Ä–µ–¥–∞–π—Ç–µ `execution_id` –≤ Sub-Workflow
3. –í Sub-Workflow –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Token Usage (Get Token Usage)** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–∫–µ–Ω–∞—Ö
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ **Token Cost (OpenRouter)** –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
5. Sub-Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ execution

### –ü—Ä–∏–º–µ—Ä Workflow

```
–û—Å–Ω–æ–≤–Ω–æ–π Workflow:
[Trigger] ‚Üí [AI Agent / Chat Model] ‚Üí [Token Usage (Save)] ‚Üí [Execute Sub-Workflow]

Sub-Workflow:
[–ü–æ–ª—É—á–µ–Ω–∏–µ execution_id] ‚Üí [Token Usage (Get Token Usage)] ‚Üí [Token Cost (OpenRouter)] ‚Üí [Google Sheets / Database]
```

### –ê–ª–µ—Ä—Ç–∏–Ω–≥ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

```
[Token Cost (OpenRouter)] ‚Üí [IF totalCost > –ø–æ—Ä–æ–≥] ‚Üí [–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Slack]
```

## –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Sub-Workflow?

n8n API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ execution —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É—è Sub-Workflow, –≤—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç–µ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π execution –∑–∞–≤–µ—Ä—à–µ–Ω –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–∫–µ–Ω–∞—Ö.

## –î–∏—Å–∫–ª–∞–π–º–µ—Ä

> [!WARNING]
> - –≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω —Å n8n GmbH –∏–ª–∏ OpenRouter
> - –¢–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–¥—Å—á—ë—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
> - –¶–µ–Ω—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ OpenRouter API –∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
> - –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ç–æ—á–Ω–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏–π –º–æ–¥–µ–ª–µ–π —Å ID –≤ OpenRouter
> - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã –≤ –¥–∞—à–±–æ—Ä–¥–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è —Ü–µ–ª–µ–π –±–∏–ª–ª–∏–Ω–≥–∞

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è n8n API](https://docs.n8n.io/api/)
- [n8n Community Nodes](https://docs.n8n.io/integrations/community-nodes/)

## –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–í–∫–ª–∞–¥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç—Å—è!

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –≤–∞—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏—Ö
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–≤—è–∑—å

- **–ê–≤—Ç–æ—Ä**: https://t.me/vlad_loop
- **Issues**: [GitHub Issues](https://github.com/Vlad-Loop/n8n-nodes-token-usage/issues)

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
